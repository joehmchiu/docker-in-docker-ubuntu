# Docker in Docker for Jenkins Container in Ubuntu

## Synopsis
The primary purpose of running Docker in a Docker Jenkins container is to allow the Jenkins system to handle multiple container instances during the CI/CD testing with the development of Docker itself.

## Systems / Applications
* OS: Linux Ubuntu 16.04
* Ansible: 2.5.2
* Docker: 18.05.0-ce
* Jenkins container: 2.60.3 (jenkins:latest)
* Python: 2.7.12
* Platform: VirtualBox

## Installation
1. git clone https://github.com/joehmchiu/docker-in-docker-ubuntu.git
2. cd docker-in-docker-ubuntu/
3. run ansible playbook by command:<br>
    $ ansible-playbook -vvv docker-jenkins.yml
4. Ignore the errors generated while cleaning the docker containers.
5. When infrastructure completed, prompt the following command to see if the docker process is up:<br>
    $ docker ps -l
<pre>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
66584ab8ccf5        myjenkins           "/bin/tini -- /usr/lâ€¦"   16 hours ago        Up 16 hours                             nostalgic_heyrovsky
</pre>
6. Update firewall to allow access going through port 8080 (generated by host).
7. Browse http://&lt;host ip&gt;:8080/ to see if the Jenkins server is online.
8. Please note this version of Jenkins container will go to the installation process, follow the instruction to complete the installation. 
9. You may run your dockerfile as docker client by Jenkins pipeline to see the docker status by using the following command. <br>
    $ docker stats
<pre>
CONTAINER ID        NAME                  CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS
66584ab8ccf5        nostalgic_heyrovsky   29.19%              379.7MiB / 6.773GiB   5.47%               0B / 0B             4.22MB / 12.6MB     122
607873b0c41c        ecstatic_chebyshev    1.93%               760KiB / 6.773GiB     0.01%               2.17kB / 0B         0B / 0B             9
65b0e69250aa        brave_payne           2.84%               1.586MiB / 6.773GiB   0.02%               1.86kB / 0B         0B / 0B             8
</pre>

## Threading
The maximum queues seems to be handling only two threads at the same time in my machine. The other threads need to be queued until the previous process completed. It seems not like docker client which can handle more than 5 threads simultaneously for some reason.

## License
A short snippet describing the license (MIT, Apache, etc.)

